# 一、当前项目说明

## 1.1 项目业务概述

尚庭公寓是一个公寓租赁平台项目，包含**移动端**和**后台管理系统**，其中移动端面向广大用户，提供找房、看房预约、租约管理等功能，后台管理系统面向管理员，提供公寓（房源）管理、租赁管理、用户管理等功能。下面分别介绍两端的具体业务功能。

![](.\images\项目示意图.drawio.png)

### 1.1.1 移动端

移动端的线上体验地址为：http://139.198.127.41:8002，其主要业务功能如下图所示

![](.\images\移动端-业务功能.drawio.svg)

各功能模块具体内容如下

- **房源检索**

  用户可以使用这个功能来搜索和检索符合其需求的房源。他们可以根据不同的条件，如地理位置、租金范围、支付方式等，快速找到适合的房源。

- **看房预约管理**

  用户可以通过这个功能预约看房。他们可以选择合适的时间，预约在特定的公寓进行实地看房，以便更好地了解房源的情况和环境。

- **租约管理**

  这个功能允许用户查看和管理他们的租约信息。他们可以在移动端查看租约合同，以及提交租约终止或延长的请求。

- **房源浏览历史**

  用户可以在这里查看他们曾经浏览过的房源历史记录。这个功能可以帮助用户追踪之前感兴趣的房源，方便他们重新查看或做出决策。

### 1.1.2 后台管理系统

后台管理系统的线上体验地址为：http://139.198.127.41:8001，主要业务功能如下图所示

![](.\images\后台-业务功能.drawio.svg)

各功能模块具体内容如下

- **公寓信息管理**

  这个模块负责管理所有公寓的基本信息，包括公寓名称、地址、联系方式等。管理员可以在这里添加、编辑、删除公寓信息。

- **房间信息管理**

  该模块负责管理每个公寓内各个房间的详细信息，包括房间号、户型、面积、租金等。管理员可以在这里进行房间信息的添加、编辑和删除。

- **公寓/房间属性管理**

  这个模块允许管理员定义公寓和房间的各种属性，比如公寓和房间的配套设施，方便管理员在维护公寓信息和房间信息时进行选择。

- **看房预约管理**

  该模块用于管理用户的看房预约请求。用户可以在移动端提交看房预约，管理员可以在后台管理系统中查看和处理这些请求，以方便安排人员接待用户。

- **租约管理**

  这个模块用于管理租约的创建、修改和终止。管理员可以在这里生成租约合同，并发送给用户签约。

- **后台系统用户管理**

  该模块用于管理后台系统的用户账户信息，管理员可以创建、编辑、删除、禁用账户信息。

- **移动端用户管理**

  这个模块负责管理移动端用户的信息。管理员可以查看用户信息，处理账户相关问题。

### 1.1.3 核心业务流程

本项目的核心业务流程为签约、续约、退租，具体流程如下图所示

<img src=".\images\核心业务流程图.drawio.svg" style="zoom:40%;" />

在上述的业务流程中，会涉及到租约状态的多次变化，下面详细介绍一下租约状态。租约共有7个状态，分别是`签约待确认`、`已签约`、`已取消`、`已到期`、`退租待确认`、`已退租`、`续约待确认`，以下是这些状态的变化流程。

![租约状态变化流程.drawio](.\images\租约状态变化流程.drawio.svg)

## 1.2 项目技术概述

本项目的技术架构如下图所示。

<img src=".\images\技术架构.drawio.svg" style="zoom:50%;" />

项目采用前后端分离的模式，下面介绍各模块用到的技术。

- **前端**

  - 框架：VUE3

- **后端**

  - 框架：Spring Boot

  - 数据库访问：MyBatis、MyBatis Plus

    > MyBatis-Plus（简称 MP）是一个MyBatis的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。

  - Web：Spring MVC

- **数据存储**

  - 关系型数据库：MySQL

  - 缓存：Redis

  - 对象存储：MinIO

    > **对象存储**是用于存储非结构化数据的数据存储架构，它将一个数据单元称为一个对象，每个对象都包含数据本身、元数据（描述数据的信息）和一个唯一标识符（通常是一个URL地址）。
    >
    > 在2001年，亚马逊推出了Simple Storage Service（简称S3），这是第一个商业化的、面向互联网的对象存储服务。随后国内众多云服务厂商也都推出了自己的对象存储服务，例如阿里云的OSS，华为云的OBS，百度云的BOS等等。
    >
    > **MinIO**是一个开源的对象存储方案，兼容亚马逊S3协议。
    >
    > 对于对象存储，我们可以选择直接购买各大云厂商提供的服务，也可以选择使用开源的服务，自行安装和维护。本项目采用开源的对象存储Minio来存储图片信息。

- **部署**

  - 前端服务器：Nginx



**对于对象存储服务的理解：**

* **什么是结构化，什么是非结构化？**

  对于关系型数据库来说，比如MySQL，它是将数据存储在一个一个的表结构中，这样存储数据就是结构化进行存储。但是对于图片，音频这些数据来说，都是以二进制的形式存储数据的，这些数据就要放在非结构化的存储架构中进行存储。

* **对象存储的数据具有的唯一标识符是什么？**

  当我们使用对象存储服务比如MinIO去存储一些图片、音频数据时，MinIO会赋予这些图片、音频数据唯一的URL地址，对于这些URL地址，我们是可以直接通过Http协议去访问的。也就是说，对象存储服务，不仅提供了存储数据的功能，也提供了访问的功能。我们可以通过浏览器来直接访问对象存储服务中存储的数据。

  



# 二、项目开发流程

前后端分离项目的完整开发流程如下：

**第一步**

由产品经理负责分析市场、用户需求，并将其转化为详细的产品需求。然后创建初步的产品原型，以便更好地理解和传达产品的设计和功能。

> 原型通常指的是产品、系统或概念的初步版本或样品，旨在展示设计概念、功能、外观或其他关键特征。

**第二步**

由UI设计师基于产品需求和初步原型，设计用户界面的外观和交互，得到高保真的圆形。高保真圆形可能包含更具体的设计元素，如颜色、字体、布局等。

**第三步**

由架构师根据高保真原型，规划软件系统的整体结构和组件。他们会设计数据库架构和定义接口，输出API文档，以便开发团队进行后续工作。

> API文档是关于接口的详细说明文档，其会包含接口所提供的功能，所需参数、返回值、错误处理等细节。接口文档的目的是为开发人员、集成人员以及其他利益相关者提供清晰的指导，以便他们能够正确地使用和集成接口。
>
> ![](.\images\Knife4j示意图.png)

**第四步**

前后端开发工程师根据API文档，分别开发前端和后端的业务逻辑和功能。前端工程师负责构建用户交互界面，而后端工程师负责数据处理逻辑和数据存储。

**第五步**

测试工程师进行各种测试，以确保软件的质量和稳定性。

**第六步**

运维工程师负责配置、部署和维护应用程序的生产环境，确保应用程序能够正常运行并具备良好的性能和可用性。



# 三、项目原型

目前市面上有很多功能强大的原型设计工具，常用的有[墨刀](https://modao.cc/)，[Figma](https://www.figma.com/)等，这些工具设计出的原型美观且具备交互逻辑。以下是本项目的原型（当做原型看吧^_^）。

**移动端**地址：[点击访问](https://modao.cc/proto/yaPxwdkwrvtlaepAbqZzO/sharing?view_mode=device&screen=rbpTgNkz0plpyCNJi&canvasId=rcTgNntk14ENgkLr #租赁平台APP-分享)

**后台管理系统**地址：[点击访问](https://modao.cc/proto/jyri5tlrvvh6dn3SWyLBQ/sharing?view_mode=device&screen=rbpTgTi9axnREyQVW&canvasId=rcTgTi9ay8uTGyt0 #租赁平台后台管理-分享)





# 四、数据库设计

## 1、数据库设计理论

### 数据库模型

数据库设计中最常采用的模型为**实体（Entity）关系（Relationship）模型**，简称ER模型。其核心思想是将现实世界中的复杂数据表示为一组实体，并描述这些实体之间的关系。

* **实体**通常对应现实世界中的一个**对象**，例如：学生、班级、教师、课程。
* 每个实体都包含一组**属性**，这些属性用于描述实体，例如学生实体包含姓名、年龄、性别等属性。
* **关系**用于描述各实体之间的联系，例如学生和班级之间存在从属关系。

其中关系可分为**一对一**、**一对多**、**多对多**三种，例如学生和班级之间的关系为一对多、学生和课程之间的关系为多对多。

实体关系模型通常使用实体关系图（ER diagram）进行表示。下图是一个简易的选课系统的实体关系图，其中方框代表实体，方框之间的连线则代表实体间的关系，连线两端的不同符号用于表示一对一、一对多、多对多的关系。

<img src="./images/ER图示例.drawio.svg" alt="ER图示例.drawio" style="zoom:85%;" />

符号说明如下：

|                符号                |   说明   |
| :--------------------------------: | :------: |
|  ![](images/ER符号-零.drawio.svg)  | 表示0个  |
| ![](images/ER图符号-一.drawio.svg) | 表示1个  |
| ![](images/ER图符号-多.drawio.svg) | 表示多个 |

上述符号通常是两个**成对**使用，其分别表示**最小值**和**最大值**。

例如上述ER图中的**班级**和**学生**之间的连线：

![image-20240614140801858](.\images\image-20240614140801858.png) 

**班级**一侧的符号表示**一**（最小值和最大值都是一），**学生**一侧的符号表示**多**（最小值是一，最大值是多），其表达的含义就是班级和学生之间的关系为**一对多**，一个学生只对应一个班级，而一个班级会对应多个学生（且至少对应一个学生）。

在实际项目中，我们其实不需要关注最小值是0还是1，因为不管是0还是1，最终在数据表设计中都体现不出来。我们只需要关注数据表之间的关系是一对一、一对多还是多对多。多这一侧的最小值是什么，不需要关注。





### 数据库设计流程

传统的数据库设计流程分为三个阶段，分别是概念模型设计阶段、逻辑模型设计阶段和物理模型设计阶段。三个阶段由粗略到详细，由抽象到具体。

#### 1）概念模型设计阶段

概念模型是一个粗略的初步设计，它只关注实体之间的关系，不去探究其中细节信息。下图便是一个典型的简易选课系统数据库的概念模型：

<img src="./images/ER图示例.drawio.svg" style="zoom:85%;" />

选课包含的内容就是班级、学生、课程以及教师。



#### 2）逻辑模型设计阶段

相较于概念模型，逻辑模型会包含更多的细节信息，例如实体的属性、用于关联两个实体的字段等等。需要注意的是，逻辑模型并不关注具体的数据库实现（例如MySQL还是Oracle、以及具体使用什么类型的字段）。下图是上述选课系统数据库的逻辑模型。

<img src=".\images\ER模型-逻辑模型.drawio.svg" style="zoom: 50%;" />





#### 3）物理模型设计阶段

相较于逻辑模型，物理模型会包含更多的与所选数据库相关的具体信息，例如存储引擎、字段类型、索引等信息。一般而言，物理模型会包含最终建表所需的所有信息，下图是上述选课系统数据库的物理模型。

<img src=".\images\ER模型-物理模型.drawio.svg" style="zoom:50%;" />





## 2、当前项目的数据库设计

### 概念模型设计

在本项目中，包含的实体有**公寓**、**房间**、**租客用户**、**租约信息**、**看房预约**、**用户浏览历史**和**系统用户**这些实体。

公寓与房间之间的关系是一对多。

用户可以浏览多个房间的信息，同样一个房间可以被多个用户浏览，所以用户和浏览历史之间是一对多的关系，房间与浏览历史之间也是一对多的关系。（房间的信息和用户信息之间没有关系，是通过浏览历史这个实体联系起来的）

用户可以租用多次房间，所以用户与租约信息之间的关系是一对多；同样地，房间也可以被多个用户租约，所以房间与租约信息之间也是一对多的关系。

用户可以多次预约看房，所以用户与预约看房信息是一对多关系；公寓中，可以有多个预约的看房信息，所以公寓和预约看房信息之间是一对多关系。

最后一个实体后台管理用户信息，这个实体和其他业务实体，没有什么关系，该用户信息，实际上是管理后台登录用户的，和移动端中的业务无关。

<img src="images/项目模型-概念模型.drawio.svg" style="zoom:50%;" />



### 逻辑模型设计

在逻辑模型设计中，我们就需要考虑每个实体的属性，以及各个实体之间关联的字段。

#### 公寓信息

根据原型来设计数据库，首先，我们来看看在房间信息下，所属公寓包含哪些信息：

![image-20240614151354698](.\images\image-20240614151354698.png) 

包括的信息有：公寓名称、公寓所属地区、公寓的标签，公寓图片，以及公寓下所有房间价格的最低值。

对于这个2000/月起，其实是不属于公寓的属性，应该是属于房间的信息，只不过我们在查询的时候，将所有属于该公寓的房间中最低价格查询出来。如果该价格值放在公寓表中的话，当我们每次去修改房间表时，都要去考虑是否可能会影响公寓表。所以，该信息应该是房间表的数据。

然后点击该公寓，进入到公寓的详情页面：

<img src=".\images\image-20240614151913603.png" alt="image-20240614151913603" style="zoom:50%;" /> <img src=".\images\image-20240614151941636.png" alt="image-20240614151941636" style="zoom:50%;" />

在公寓详情页面，包括：公寓图片、公寓名称、公寓标签、公寓中房间最低价格、公寓介绍、公寓配套、公寓位置详情、公寓可选房间列表。

对于公寓位置详情来说，我们还应该在公寓表中保存一个经纬度，这样的话才能使用高德地图或者百度地图，在地图中呈现出来。

公寓信息部分的逻辑模型如下图所示：

<img src=".\images\项目模型-逻辑模型-公寓信息.drawio.svg" style="zoom: 33%;" />



#### 房间信息

房间信息包含的属性有房间号、房间租金、房间所属公寓、房间可选租期、房间可选支付方式、房间属性、房间标签、房间配套、房间图片、房间发布状态，这部分的逻辑模型如下图所示：

<img src=".\images\项目模型-逻辑模型-房间信息.drawio.svg" style="zoom:33%;" />



#### 用户信息

用户信息包含的属性有手机号码、密码、头像、昵称、账号状态，这部分的逻辑模型如下：
<img src=".\images\项目模型-逻辑模型-用户信息.drawio.svg" alt="项目模型-逻辑模型-用户信息.drawio" style="zoom:33%;" /> 



#### 看房预约信息

看房预约包含的属性有预约用户信息、预约公寓信息、预约时间、备注信息、预约状态，这部分的逻辑模型如下：
<img src=".\images\项目模型-逻辑模型-看房预约.drawio.svg" style="zoom:33%;" />

####  租约信息

租约信息包含`签约用户信息`，`签约房间信息`、`租期`、`支付方式`、`租约来源`、`租金`、`押金`，这部分的逻辑模型如下

<img src=".\images\项目模型-逻辑模型-租约信息.drawio.svg" style="zoom:33%;" />



#### 浏览历史信息

浏览历史指的是用户浏览房间详情的历史，包含的属性有`用户信息`、`房间信息`、`浏览时间`，这部分的逻辑模型如下

<img src=".\images\项目模型-逻辑模型-浏览历史.drawio.svg" alt="项目模型-逻辑模型-浏览历史.drawio" style="zoom:33%;" />

#### 后台管理用户信息

后台管理系统用户包含的属性有，这部分的逻辑模型如下

<img src=".\images\项目模型-逻辑模型-后台用户.drawio.svg" style="zoom:33%;" />

### 物理模型设计

本项目采用MySQL数据库，所有表均使用InnoDB存储引擎，完整的物理模型如下图，详细信息可参考资料中的数据库初始化文件`lease.sql`。

![](.\images\项目模型-物理模型.drawio.svg)

**注意**：

- 所有表均省略了`create_time`、`update_time`、`is_deleted`三个字段。
- 所有的状态或类型字段（例如租约状态），均使用数字表示。

也就是说，这些表中都不会去做物理删除，都是进行逻辑删除操作，不会真正的删除数据，我们每次去查询时，都会去过滤掉已经逻辑删除的数据。



---

# 五、接口定义

## 1、后台管理系统接口定义

### 公寓信息管理

#### 属性管理

属性管理页面包含公寓和房间各种可选的属性信息，其中包括**房间的可选支付**、**房间的可选租期**、**房间的配套**、**公寓的配套**等等。其所需接口如下：

* **房间支付方式管理**

  页面如下：

  ![](.\images\接口定义-后台-属性管理-支付方式.png)

  所需接口如下：

  * `查询全部支付方式列表`
  * `保存或更新支付方式`
  * `根据ID删除支付方式`

* **房间租期管理**

  **页面如下**

  ![](.\images\接口定义-后台-属性管理-租期管理.png)

  **所需接口如下：**

  * `查询全部租期列表`
  * `保存或更新租期`
  * `根据ID删除租期`

* **标签管理**

  **页面如下：**

  ![](.\images\接口定义-后台-属性管理-标签管理.png)

  所需接口如下：

  * `保存或更新标签`
  * `查询标签列表`
  * `根据ID删除标签`

* **配套管理**

  **页面如下**

  ![](.\images\接口定义-后台-属性管理-配套管理.png)

  所需接口如下：

  * `保存或更新配套`
  * `查询配套列表`
  * `根据ID删除配套`

* **房间基本属性管理**

  **页面如下**

- ![接口定义-后台-属性管理-房间基本属性](.\images\接口定义-后台-属性管理-房间基本属性.png)

  **所需接口如下**

  - `保存或更新属性名称`
  - `保存或更新属性值`
  - `查询全部属性名称和属性值列表`
  - `根据ID删除属性名称`

  - `根据ID删除属性值`

- **公寓杂费管理**

  **页面如下**

  ![](.\images\接口定义-后台-属性管理-杂费管理.png)

  **所需接口如下**

  - `保存或更新杂费名称`
  - `保存或更新杂费值`
  - `查询全部杂费名称和杂费值列表`
  - `根据ID删除杂费名称`

  - `根据ID删除杂费值`

#### 公寓管理

- **公寓列表页面**

  **页面如下**

  ![](.\images\接口定义-后台-公寓管理-公寓列表.png)

  **所需接口如下**

  - `根据条件分页查询公寓列表`

  - 查询条件所需接口
    - `查询省份列表`
    - `根据省份ID查询城市列表`
    - `根据城市ID查询区县列表`
  - `根据ID修改公寓发布状态`
  - `根据ID删除公寓信息`

- **公寓详情页面**

  **页面如下**

  <img src=".\images\接口定义-后台-公寓管理-公寓详情.png" style="zoom: 67%;" />

  **所需接口如下**

  - `根据ID查询公寓详细信息`（用作修改时的表单回显）
  - `保存或更新公寓信息`
  - 表单所需接口

    - `查询省份列表`
    - `根据省份ID查询城市列表`
    - `根据城市ID查询区县列表`
    - `查询公寓配套列表`
    - `查询公寓标签列表`
    - `查询公寓杂费信息列表`
    - `上传图片`

#### 房间管理

- **房间列表页面**

  **页面如下**

  ![接口定义-后台-公寓管理-房间列表](.\images\接口定义-后台-公寓管理-房间列表.png)

  **所需接口如下**

  - `根据条件分页查询房间列表`

  - 查询条件所需接口

    - `查询省份列表`
    - `根据省份ID查询城市列表`
    - `根据城市ID查询区县列表`
    - `根据区县ID查询公寓列表`
  - `根据ID修改房间发布状态`
  - `根据ID删除房间信息`

- **房间详情页面**

  **页面如下**

  <img src=".\images\接口定义-后台-公寓管理-房间详情.png" style="zoom:33%;" />

  **所需接口如下**

  - `根据ID查询房间详细信息`（用作修改时的表单回显）
  - `保存或更新房间信息`
  - 表单所需接口
    - `查询省份列表`
    - `根据省份ID查询城市列表`
    - `根据城市ID查询区县列表`
    - `根据区县ID查询公寓列表`
    - `查询房间属性列表`
    - `查询房间标签列表`
    - `查询全部支付方式列表`
    - `查询租期列表`
    - `上传图片`

### 租赁管理

#### 预约看房管理

- **看房预约列表页面**

  **页面如下**

  ![](.\images\接口定义-后台-看房预约管理-预约列表.png)

  **所需接口如下**

  - `分页查询预约信息列表`

  - 查询条件所需接口

    - `查询省份列表`
    - `根据省份ID查询城市列表`
    - `根据城市ID查询区县列表`
    - `根据区县ID查询公寓列表`
  - `根据ID更新预约状态`

#### 租约管理

- **租约列表页面**

  **页面如下**

  ![接口定义-后台-看房预约管理-预约列表](.\images\接口定义-后台-租约管理-租约列表.png)

  **所需接口如下**

  - `根据条件分页查询租约信息列表`
  - 查询条件所需接口

    - `查询省份列表`
    - `根据省份ID查询城市列表`
    - `根据城市ID查询区县列表`
    - `根据区县ID查询公寓列表`
  - `根据ID更新租约状态`
  - `根据ID删除租约信息`

- **租约详情页面**

  **页面如下**

  <img src=".\images\接口定义-后台-租约管理-租约详情.png" style="zoom:33%;" />

  **所需接口**

  - `根据ID查询租约信息`（用作更新租约时的表单回显）
  - `保存或修改租约信息`
  - 表单所需接口

    - `查询省份列表`
    - `根据省份ID查询城市列表`
    - `根据城市ID查询区县列表`
    - `根据区县ID查询公寓列表`
    - `根据公寓ID查询房间列表`
    - `查询可选支付方式列表`
    - `查询可选租期列表`

### 用户管理

#### 用户列表页面

**页面如下**

<img src=".\images\接口定义-后台-用户管理-用户列表.png" style="zoom: 50%;" />

**所需接口如下**

- `分页查询用户信息列表`
- `根据用户ID更新账号状态`

### 系统管理

#### 系统用户岗位管理

- **岗位列表页面**

  **页面如下**

  ![](.\images\接口定义-后台-系统岗位管理-岗位列表.png)

  **所需接口如下**

  - `分页查询岗位信息列表`
  - `根据ID修改岗位状态`
  - `根据ID删除岗位`

- **岗位详情页面**

  **页面如下**

  <img src=".\images\接口定义-后台-系统岗位管理-岗位详情.png" style="zoom: 50%;" />

  **所需接口如下**

  - `根据ID查询岗位详细信息`（用作修改时的表单回显）
  - `保存或更新岗位信息`

#### 系统用户信息管理

- **系统用户列表页面**

  **页面如下**

  ![](.\images\接口定义-后台-系统用户管理-用户列表.png)

  **所需接口如下**

  - `根据条件分页查询系统用户列表`
  - `根据ID修改用户状态`
  - `根据ID删除系统用户信息`

  **所需接口如下**

- **系统用户详情页面**

  **页面如下**

  <img src=".\images\接口定义-后台-系统用户管理-用户详情.png" style="zoom: 50%;" />

  **所需接口如下**

  - `根据ID查询系统用户详细信息`
  - `保存或更新系统用户信息`
  - `表单所需接口`
    - 查询岗位列表

### 登录管理

#### 登录页面

**页面如下**

<img src=".\images\接口定义-后台-登录管理.png" style="zoom:40%;" />

**所需接口如下**

- `获取图形验证码`
- `请求登录`
- `获取登录用户信息`

## 2、移动端接口定义

### 登录

#### 登录页面

页面如下

<img src=".\images\移动端-登录页面.png" style="zoom: 50%; border: 1px solid rgb(0, 0, 0);" />

所需接口如下

- `获取短信验证码`
- `请求登录`
- `获取登录用户基本信息`

### 找房

#### 房间列表页面

页面如下

<img src=".\images\移动端-房间列表.png" style="zoom:50%;border: 1px solid #000;" />

所需接口如下

- `根据查询条件分页查询房间列表`
- 查询条件所需接口

  - `查询省份列表`
  - `根据省份ID查询城市信息`
  - `根据城市ID查询区县信息`
  - `查询支付方式列表`

#### 房间详情页面

页面如下

<img src=".\images\移动端-房间详情.png" style="zoom:50%;" />

所需接口如下

- `根据ID查询房间详细信息`

#### 公寓详情页面

页面如下

<img src=".\images\移动端-公寓详情.png" style="zoom:50%;" />

所需接口如下

- `根据ID查询公寓详细信息`
- `根据公寓ID查询房间列表`

### 个人中心

#### 浏览历史

页面如下

<img src=".\images\移动端-浏览历史.png" style="zoom:50%; border: 1px solid #000;" />

所需接口如下

- `查询登录用户的浏览历史列表`

#### 看房预约

- **看房预约列表页面**

  页面如下

  <img src=".\images\移动端-看房预约列表.png" style="zoom:50%;border: 1px solid #000;" />

  所需接口如下

  - `查询登录用户的看房预约列表`

- **看房预约详情页面**

  页面如下

  <img src=".\images\移动端-看房预约详情.png" style="zoom:50%;" />

  所需接口如下

  - `根据ID查询看房预约详细信息`
  - `保存或更新看房间预约信息`

#### 租约管理

- **租约列表页面**

  页面如下

  <img src=".\images\移动端租约-列表-1.png" style="zoom:50%;border: 1px solid #000" />

  <img src=".\images\移动端租约-列表-2.png" style="zoom:50%;border: 1px solid #000" />

  所需接口如下

  - `查询登录用户的租约列表`
  - `根据ID修改租约状态`

- **租约详情页面**

  页面如下

  <img src=".\images\移动端租约-详情.png" style="zoom: 33%;" />

  所需接口如下

  - `根据ID查询租约详细信息`
  - `保存或修改租约信息`
  - 表单所需接口
    - `根据房间ID查询可选支付方式列表`
    - `根据房间ID查询可选租期列表`

### 我的房间

略

### 圈子

略

### 消息通知

略









---

# 六、开发准备

## 1、开发环境准备

### 准备Linux虚拟机

准备两台虚拟机——`server01`和`server02`，在开发阶段只需要一台虚拟机即可，另外一台留到后续的项目部署阶段使用。实际操作时，可先按照要求准备一台，然后直接克隆得到第二台服务器。

只不过，当我们使用克隆的方式克隆出来的服务器，该服务器的中的主机名与所设置的静态IP地址都是与原服务器相同的，所以需要我们修改。

这两台服务器的要求如下：

* **操作系统为CentOS7**

  > 由于下面的笔记中，软件的安装步骤都是基于CentOS7系统的，所以建议统一使用CentOS7系统。

  

* **网络设置**

  > 虚拟机网络使用NAT模式，子网IP设置为192.168.200.0，并且为虚拟机配置静态IP地址，其中server01服务器的静态IP地址配置为192.168.200.101，server02服务器的静态IP地址配置为192.168.200.102。
  >
  > 具体步骤请查看笔记： [3、NAT网络配置以及静态IP地址的配置.md](..\..\5、Linux\3、NAT网络配置以及静态IP地址的配置.md) 

  

* **主机名设置**

  为两台主机分别设置一个主机名，分别是server01和server02，设置主机名的命令如下

  ```shell
  hostnamectl set-hostname <主机名> --static
  ```

* **配置好SSH远程登录**

  我们这里使用的是Xshell软件来实现远程登录的，具体该如何实现远程登录请查看笔记： [4、Xshell、Xftp连接虚拟机.md](..\..\5、Linux\4、Xshell、Xftp连接虚拟机.md) 

  

* **与网络时间保持同步**

  我们可以使用`date`命令，来查看Linux系统中的时间。

  有时候，Linux系统的时间，没有跟网络时间保持同步，我们可以安装一个时间同步工具`chrony`，来实现系统时间与网络时间保存同步。

  执行以下命令安装chrony：

  ```shell
  yum install chrony
  ```

  系统中一般会预装该软件，所以执行yum install chrony命令会提示已安装且是最新版本。

  那么只要我们打开这个时间同步工具chrony，它就会自动地将系统的时间与网络时间进行同步。

  执行以下命令启动chrony，并设置为开机启动：

  ```shell
  systemctl start chronyd
  systemctl enbale chronyd
  ```



* **关闭防火墙**

  由于防火墙的存在，会阻止一些外部的请求，其中就会包括Http请求。如果我们不关闭防火墙的话，那么当我们将项目部署到服务器上之后，我们就需要在主机上，使用浏览器去访问该项目，此时发送的请求就是Http请求，由于防火墙的存在，这个Http请求就会被拦截，主机就无法访问。

  所以，我们需要去关闭防火墙：

  ```shell
  #关闭防火墙 
  systemctl stop firewalld
  
  #禁止防火墙开机自启
  systemctl disable firewalld
  ```

  

* **关闭SElinux**

  SElinux，全称为Security-Enhanced Linux，是一种用于Linux操作系统的安全增强功能，为保证后续部署阶段的Nginx能够正常工作，此处关闭SELinux功能。

  先去修改SELinux配置文件

  打开配置文件

  ```shell
  vim /etc/selinux/config
  ```

  修改内容如下

  ```shell
  SELINUX=disabled
  ```

  然后重启操作系统，SElinux就关闭了

  ```shell
  reboot
  ```



经过上面的步骤，一台虚拟机就配置完毕了。

我们还需要第二台虚拟机server02，可以使用去使用克隆的方式。对克隆后的虚拟机，我们去修改其主机名、静态IP，以及UUID，具体步骤请查看笔记： [5、Linux虚拟机的克隆（可选）.docx](..\..\5、Linux\5、Linux虚拟机的克隆（可选）.docx) 





---

### 部署MySQL

部署MySQL可以使用两种方式，一种是使用rpm离线安装，一种是使用yum在线安装。

#### MySQL的卸载

1. **`关闭MySQL服务`**

   ```shell
   systemctl stop mysqld.service
   ```

2. **`查看当前MySQL安装状况`**

   ```shell
   rpm -qa | grep -i mysql
   
   #或
   
   yum list installed | grep mysql
   ```

   

3. **`卸载上述命令查询出的已安装程序`**

   ```shell
   yum remove mysql-xxx mysql-xxx mysql-xxx mysqk-xxxx
   ```

   务必删除干净，反复执行`rpm -qa | grep -i mysql`确认是否有卸载残留

4. **`删除mySQL相关文件`**

   * 查找相关文件

     ```shell
     find / -name mysql
     ```

   * 删除上述命令查找出的相关文件

     ```shell
     rm -rf xxx
     ```

5. **`删除my.cnf`**

   ```shell
   rm -rf /etc/my.cnf
   ```






#### 安装MySQL的两种方式

##### 方式一：使用rpm安装mysql

**检查是否安装过mysql**

* 如果使用的是rpm安装，检查一下RPM PACKAGE:

  ```shell
  rpm -qa | grep -i mysql
  ```

* 检查mysql service：

  ```shell
  systemctl status mysqld.service
  ```

* 如果存在mysql-libs的旧版本包，显示如下：

  ![image-20240325165146432](.\images\image-20240325165146432.png)

* 如果不存在mysql-lib的版本，显示如下：

  ![image-20240325165216512](.\images\image-20240325165216512.png)



**然后去下载MySQL的指定版本**

进入到MySQL官网中，下载MySQL8版本

<img src=".\images\image-20240325214449488.png" alt="image-20240325214449488" style="zoom:80%;" />   

由于是要给Linux系统下载MySQL数据库，所以，需要将下载的版本选择为Linux系统。

需要为CentOS 7下载MySQL数据库，但是这里并没有CentOS 7的选项，这里选择Red Hat Enterprise Linux/Oracle Linux，这是与CentOS 7兼容的。

然后再选择系统的版本

<img src=".\images\image-20240325214710471.png" alt="image-20240325214710471" style="zoom:67%;" /> 

这里选择版本7，x86版本。

之后选择下载包的类型，这里选择的是`RPM Bundle`。

<img src=".\images\image-20240325214749943.png" alt="image-20240325214749943" style="zoom:67%;" /> 

下载好的tar包，使用压缩工具解压，就可以得到很多的rpm文件。我们只需要其中的一部分安装包即可。

![image-20240325215024086](.\images\image-20240325215024086.png)

**将选中的文件，复制一份，使用Xftp软件，粘贴到CentOS 7系统的`/opt`目录下，这样一来，MySQL文件就复制到了CentOS 7系统中了。**





**rpm安装MySQL**

1. **先将安装程序拷贝到/opt目录下**

在Linux中，/opt目录就是用来存放安装的软件与程序的，所以需要先将下载的MySQL文件拷贝到/opt目录下进行安装操作。

由于之前，已经使用了Xftp软件，将下载的一部分MySQL文件拷贝到了/opt目录下，这里就不再阐述。

2. **在MySQL的安装目录下执行：**

首先进入到/opt目录下：

```shell
cd /opt
```

然后，在/opt目录下，按照顺序，一步一步地，依次执行下述语句：

```shell
rpm -ivh mysql-community-common-8.0.25-1.el7.x86_64.rpm

rpm -ivh mysql-community-client-plugins-8.0.25-1.el7.x86_64.rpm
 
rpm -ivh mysql-community-libs-8.0.25-1.el7.x86_64.rpm

rpm -ivh mysql-community-client-8.0.25-1.el7.x86_64.rpm

rpm -ivh mysql-community-server-8.0.25-1.el7.x86_64.rpm
```

* `rpm`是Redhat Package Manage缩写，通过RPM的管理，用户可以把源代码包装成以rpm为扩展名的文件形式，易于安装。
* `-i`，--install安装软件包
* `-v`，--verbose提供更多的详细信息输出
* `-h`，--hash软件包安装的似乎列出哈希标志（和-v一起使用效果更好），展示进度条。



**注意：**

1. 必须要按照顺序，一步一步地执行语句，有可能下载的MySQL版本不一样，导致文件名不一致而报错误，上例中使用的是8.0.25版本的MySQL，根据实际使用的MySQL版本进行安装即可。

2. 如在检查工作时，没有检查mysql依赖环境，则在安装mysql-community-server会报错。

3. 实际上按照：**`common -> client-plugins -> libs -> client -> server`**的顺序进行执行。

4. 在安装`mysql-community-libs`时，有可能会报一个错误信息：

   ![image-20240325221522356](.\images\image-20240325221522356.png)

   使用命令：**`yum remove mysql-libs`**解决，清除之前安装过的依赖即可。







##### 方式二：使用yum安装Mysql

在CentOS7系统中部署MySQL，具体的步骤可以参考官方的MySQL文档：[MySQL :: MySQL Installation Guide :: 7.1 Installing MySQL on Linux Using the MySQL Yum Repository](https://dev.mysql.com/doc/mysql-installation-excerpt/8.0/en/linux-installation-yum-repo.html)

**实现步骤**

1. **安装MySQL yum库**

   由于在Linux内置的yum仓库中，是没有MySQL的安装包的，所以我们需要给MySQL配置一个yum仓库，然后使用yum命令实现安装。

   * **下载yum库**

     首先，我们要去先下载一个yum仓库的配置文件，该文件安装后，会自动去配置yum仓库，然后就可以使用yum命令安装MySQL。

     下载地址：[MySQL :: Download MySQL Yum Repository](https://dev.mysql.com/downloads/repo/yum/)

     进入到该地址后，选择适合的版本，我们选择的是Red Hat Enterprise Linux 7的版本：

     <img src=".\images\image-20240616155910801.png" alt="image-20240616155910801" style="zoom: 50%;" /> 

     然后点击Download， 点击下载：

     <img src=".\images\image-20240616155953818.png" alt="image-20240616155953818" style="zoom:33%;" /> 

     就会将rpm文件下载下来。

     也可以直接使用命令：

     ```shell
     wget https://dev.mysql.com/get/mysql84-community-release-el7-1.noarch.rpm
     ```

     进行下载。

     注意，这里的wget命令后面跟着的的下载链接，是我写笔记时最新的下载链接，由于版本可能会不断地更迭，建议使用最新的版本以免出现安装失败的问题。所以，建议去下载时先去该网站复制最新的下载链接，然后使用wget命令下载。

     在Linux系统中，自己下载的安装包一般都放在/opt目录下，所以我们可以使用wget命令的-P选项指定下载到/opt目录：

     ```shell
     wget -P /opt/ https://dev.mysql.com/get/mysql84-community-release-el7-1.noarch.rpm
     ```

   * **安装yum库**

     下载好后，我们来查看一下刚才下载的rpm文件：

     ![image-20240616160839953](.\images\image-20240616160839953.png) 

     下载的文件名为mysql84-community-release-el701.noarch.rpm，那么我们就可以使用rpm命令安装rpm的文件：

     ```shell
     rpm -ivh mysql84-community-release-el7-1.noarch.rpm 
     ```

     安装好后，我们去查看一下本地的yum仓库：

     <img src=".\images\image-20240616161107859.png" alt="image-20240616161107859" style="zoom:67%;" /> 

     就可以看见，此时在yum仓库中，就多出了与mysql有关的配置文件。

     此时，就可以去安装mysql了，只不过此时，下载的速度比较慢，因为mysql的yum仓库服务器是在国外，我们去下载mysql网速会很慢，所以为了让下载速度能够快一点，我们可以为Yum仓库配置国内的镜像。就类似于maven仓库配置国内镜像的道理是一样的。

   * **配置国内镜像**

     修改`/etc/yum.repos.d/mysql-community.repo`文件中的baseUrl参数，修改内容如下：

     ![image-20240616161711869](.\images\image-20240616161711869.png)

     将mysql80-community部分中的baseurl属性修改为下面的值： 

     ```ini
     baseurl=https://mirrors.tuna.tsinghua.edu.cn/mysql/yum/mysql-8.0-community-el7-$basearch/
     ```

     然后注意，我们需要去更改该配置文件中各个版本的enabled属性值。

     这个enabled属性值，表示的是我们使用yum命令去安装mysql时，安装的版本：

     <img src=".\images\image-20240616162326116.png" alt="image-20240616162326116" style="zoom:67%;" /> 

     可以看到，此时只有mysql-8.4-lts-community这个版本的enabled属性值为1，也就是说，此时我们使用yum命令安装MySQL默认安装的是mysql-8.4版本。

     但是，我们这里不想安装mysql8.4版本，想安装mysql80版本，那么可以将mysql-8.4版本的enabled属性值修改为0，将mysql80版本的enabled属性修改为1，这样我们使用yum命令安装的mysql就是8.0版本的：

     <img src=".\images\image-20240616162622018.png" alt="image-20240616162622018" style="zoom: 67%;" /> 



2. **安装MySQL**

执行如下命令安装MySQL

```shell
yum -install -y mysql-community-server
```

由于上述修改了/etc/yum.repos.d/mysql-community.repo中版本的enabled属性，所以此时下载的MySQL是8.0版本的。



#### 查看MySQL版本

执行如下命令，如果成功表示安装mysql成功。类似java -version打出版本等信息

```shell
mysql --version
#或
mysqladmin --version
```

<img src=".\images\image-20240325222525678.png" alt="image-20240325222525678" style="zoom: 80%;" /> 

执行如下名，查看是否安装成功。需要增加-i表示不去区分大小写，否则搜索不到。

```shell
rpm -qa|grep -i mysql
```

<img src=".\images\image-20240325222611635.png" alt="image-20240325222611635" style="zoom:67%;" /> 



#### MySQL服务的初始化

为了保证数据库目录与文件的所有者为mysql登录用户，如果你是以root身份运行mysql服务，需要执行下面的命令进行初始化：

```shell
mysqld --initialize --user=mysql
```

说明：--initialize选项默认以"安全"模式来初始化，则会为root用户生成一个密码并`将该密码标记为过期`，登录后你需要去设置一个新的密码。生成的`临时密码`会往日志中记录一份。

查看密码：

```shell
cat /var/log/mysqld.log | grep root@localhost
```

![image-20240617105424561](.\images\image-20240617105424561.png) 

root@localhost后面的就是初始化的密码，也就是hQHPg5tab9-j



#### 启动MySQL，查看状态

这个时候，就可以去登录MySQL数据库了，不过在此之前，需要确保MySQL服务已经启动。

**查看MySQL服务器状态：**

```shell
#加不加.service后缀都可以
systemctl status mysqld.service
```

![image-20240325223909087](.\images\image-20240325223909087.png)

`dead`就表示MySQL服务已经关闭停止了，此时我们就需要启动MySQL服务。

```shell
#加不加.service后缀都可以

启动：systemctl start mysqld.service

关闭：systemctl stop mysqld.service

重启：systemctl restart mysqld.service
```

启动后，我们再去查看mysql服务：

![image-20240325224236226](.\images\image-20240325224236226.png)

此时的MySQL服务就是running状态。

我们也可以通过查看系统进程的方式，查看到mysql服务是否启动：

```shell
ps -ef | grep -i mysql
```

![image-20240325224345946](.\images\image-20240325224345946.png)





#### 查看MySQL服务是否自启动

```shell
systemctl list-unit-files|grep mysqld.service
```

![image-20240325225724251](.\images\image-20240325225724251.png)

默认是enabled，表示MySQL服务自启动。

如果不是enabled，可以运行如下命令设置自启动：

```shell
systemctl enable mysqld.service
```

如果希望不进行自启动，运行如下命令设置：

```shell
systemctl disable mysqld.service
```

![image-20240325225843328](.\images\image-20240325225843328.png) 





#### 登录MySQL

首次登录通过`mysql -hlocalhost -P3306 -uroot -p`进行登录，此时的密码是初始密码，也就是MySQL服务初始化时，生成的临时密码，可以使用`cat /var/log/mysqld.log | grep root@localhost`进行查看：

![image-20240617105424561](.\images\image-20240617105424561.png)

也就是hQHPg5tab9-j。

登录MySQL：

![image-20240325234836916](.\images\image-20240325234836916.png)



#### 修改密码

因为初始化密码默认是过期的，所以查看数据库会报错。

**修改密码：**

```sql
ALTER USER 'root'@'localhost' IDENTIFIED BY '新密码';
```

修改完成后，重新进入到MySQL数据库中，就可以正常地使用数据库了。

**注意**：MySQL默认安装了[validate_password](https://dev.mysql.com/doc/refman/8.0/en/validate-password.html) 插件，默认情况下，要求密码要包含大写字母、小写字母、数字和特殊符号，且密码长度最小为8。若需设置简单密码，可禁用该插件，或调整该插件的密码强度级别。

**禁用validate_password插件的方式：**

打开Linux系统mysql的配置文件：

```shell
vim /etc/my.cnf
```

将下面的内容添加到配置文件中：

```properties
[mysqld]
validate_password.check_user_name=OFF
validate_password.length=4
validate_password.mixed_case_count=0
validate_password.number_count=0
validate_password.policy=0
validate_password.special_char_count=0
```

保存退出，然后重启mysql服务：

```shell
systemctl restart mysqld.service
```

此时，vaildate_password所有规则都被修改了，那么此时我们就可以随便地设置mysql用户密码了。

<img src=".\images\image-20240617114225237.png" alt="image-20240617114225237" style="zoom:67%;" /> 





#### 远程登录

**远程登录存在的问题**

在使用SQLyog或者Navicat去远程连接MySQL数据库时，遇到了下面的报错信息，这是由于MySQL配置了不支持远程连接引起的。

<img src=".\images\image-20240326095118565.png" alt="image-20240326095118565" style="zoom: 50%;" /> 



**实现步骤**

**1、确认网络**

1. 在远程机器上使用ping ip地址`保证网络畅通`

2. 确保本地机器`开启telnet命令`：

<img src=".\images\image-20240326100232717.png" alt="image-20240326100232717" style="zoom:50%;" /> 

<img src=".\images\image-20240326100244902.png" alt="image-20240326100244902" style="zoom: 67%;" /> 

<img src=".\images\image-20240326100303664.png" alt="image-20240326100303664" style="zoom:67%;" /> 



**2、关闭防火墙或开放端口**

需要把本地（Windows系统)的防火墙关闭，这样才可以去连接远程机器。

然后，可以选择去关闭远程机器的防火墙或者开放远程机器的3306端口。

**`方式一：关闭远程机器防火墙`**

**查看防火墙状态**

```shell
systemctl status firewalld.service
```

**打开防火墙**

```shell
systemctl start firewalld
```

**关闭防火墙**

```shell
systemctl stop firewalld
```

**设置开机启动防火墙**

```shell
systemctl enable firewalld
```

**设置开机禁用防火墙**

```shell
systemctl disable firewalld
```

我们可以使用上面的命令，去设置远程机器关闭防火墙，这样就给了远程连接一个基础。



**`方式二：开放远程机器的端口`**（推荐）

远程连接，要么去关闭防火墙，要么在开启防火墙的基础上，开放MySQL数据库连接的端口3306，只让该端口允许进行访问。

**查看开放的端口号**

```shell
firewall-cmd --list-all
```

**设置开放的端口号**

```shell
firewall-cmd --add-service=http --permanent

firewall-cmd --add-port=3306/tcp --permanent
```

**重启防火墙**

```shell
firewall-cmd --reload
```



**3、修改Linux配置**

在默认的情况下，MySQL数据库是不允许root用户进行远程连接的，root用户在默认的情况下只允许进行本地连接。我们可以通过下面的操作查看：

```sql
use mysql;

select Host, User from user;
```

![image-20240326101152277](.\images\image-20240326101152277.png) 

我们可以看到，root用户的当前主机配置信息为localhost，即root用户只允许localhost本地访问，不允许进行远程访问。

那如何进行修改？

* **`修改Host为通配符%`**

Host列指定了允许用户登录所使用的IP，比如user=root Host=192.168.1.1。这里的意思就是说root用户只能通过192.168.1.1的客户端去访问。user=root Host=localhost，表示只能通过本地客户端去访问。而`%`是个`通配符`，如果Host=192.168.138.%，那么就表示只要是IP地址前缀为"192.168.138."的客户端都可以连接。如果`Host=%`，表示所有IP都有连接权限。

注意：在生成环境下不能为了省事将host设置为%，这样做会存在安全问题，具体的可以根据生成环境的IP进行设置。

```sql
update user set host = '%' where user = 'root';
```

Host设置了'%'后便允许进行远程访问。

![image-20240326103216451](.\images\image-20240326103216451.png) 



不管在一般情况下，我们都会去创建一个用户，用于远程登录（该角色会限定权限，而不是像下面一样赋予所有权限）：

```mysql
CREATE USER 'root'@'%' IDENTIFIED BY '061535asd';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION;
```

上述第一条命令表示去创建一个root用户，可以在任何地址登录。

第二条命令表示给这个新创建的root用户赋予所有权限，并且WITH GRANT OPTION命令表示该用户可以将自己的权限赋予其他用户。



Host修改完成后记得执行flush privileges使配置立即生效：

```sql
flush privileges;
```

这个时候，去连接远程数据库就连接成功了。

<img src=".\images\image-20240326101403182.png" alt="image-20240326101403182" style="zoom: 50%;" /> 



**远程登录可能存在的问题**

如果是MySQL8的版本，连接时可能会出现如下的问题：

<img src=".\images\image-20240326103426142.png" alt="image-20240326103426142" style="zoom: 50%;" /> 

配置新连接报错：错误号码2058，分析是mysql密码加密方法变了。

解决方法：Linux下mysql -uroot -p 登录mysql数据库，然后执行这条SQL语句：

```sql
ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY '密码';
```

然后再重新配置远程连接，即可连接成功。









---

### 部署Redis

部署Redis服务，安装方式采用yum在线安装，安装版本是最新版本7.2.5，具体步骤如下：

#### 安装Redis的yum仓库

Redis所在的仓库为remi-release，下载地址为http://rpms.famillecollet.com/enterprise/remi-release-7.rpm，我们先进入到/opt目录下，在opt目录中使用下面的命令下载的服务器：

```shell
wget http://rpms.famillecollet.com/enterprise/remi-release-7.rpm
```

此时，在opt目录下，就会有一个yum仓库的rpm文件：

![image-20240617123422876](.\images\image-20240617123422876.png) 

然后我们使用rpm命令安装：

```shell
rpm -ivh remi-release-7.rpm
```

这样一来，在yum仓库中，就会有了redis的配置文件，在/etc/yum.repos.d目录下查看：

<img src=".\images\image-20240617123617463.png" alt="image-20240617123617463" style="zoom: 50%;" /> 



#### 安装Redis

执行以下命令安装Redis：

```
yum --enablerepo=remi -y install redis
```

注：--enablerepo选项的作用为启用一个仓库

<img src=".\images\image-20240617130057868.png" alt="image-20240617130057868" style="zoom:67%;" /> 



#### 配置Redis允许远程访问

Redis服务默认只允许本地访问，若需要进行远程访问，需要进行配置。

修改Redis配置文件

```shell
vim /etc/redis/redis.conf
```

需要去修改bind参数，我们在命令行模式下，搜索bind参数：/bind：

<img src=".\images\image-20240617130409124.png" alt="image-20240617130409124" style="zoom: 67%;" /> 

默认只允许本地访问，我们将其修改为：

```ini
#监听所有网络接口，默认只监听localhost
bind 0.0.0.0
```

然后，我们要去关闭保护模式。Redis默认是开启保护模式的，开启保护模式后，远程访问必须进行认证才能访问。

在开发环境下，一般将远程保护关闭，我们只需要配置IP地址和端口号就可以访问远程的Redis了，但是在生产环境下，必须将远程保护打开，我们不仅需要配置IP地址和端口号，还需要配置验证信息。

也是在命令行模式下，输入/protected：

<img src=".\images\image-20240617130606057.png" alt="image-20240617130606057" style="zoom:67%;" /> 

将其值修改为no即可：

```ini
protected-mode no
```

 

#### 启动Redis

执行下面的命令启动Redis

```shell
systemctl start redis
```

执行以下的命令查看Redis的运行状态

```shell
systemctl status redis
```

执行以下的命令设置Redis开机启动

```shell
systemctl enable redis
```

查看Redis服务是否开机启动

```shell
systemctl list-unit-files|grep redis.service
```





---

### 部署MinIO

在Linxu中部署MinIO，安装方式采用rpm离线安装，具体步骤可参考：[官方文档](https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html#minio-snsd)。

#### 下载MinIO安装包

下载地址如下：

https://dl.min.io/server/minio/release/linux-amd64/archive/minio-20240613225353.0.0-1.x86_64.rpm

我们先进入到/opt目录，通过以下命令，以下命令将安装包下载至服务器：

```shell
wget https://dl.min.io/server/minio/release/linux-amd64/archive/minio-20240613225353.0.0-1.x86_64.rpm
```



#### 安装MinIO

```shell
rpm -ivh minio-20240613225353.0.0-1.x86_64.rpm
```

此时，MinIO就安装完毕了。



#### 测试MinIO服务

使用minio来启动MinIO服务，我们使用minio -h来查看一下minio的帮助信息：

<img src=".\images\image-20240617140854525.png" alt="image-20240617140854525" style="zoom:67%;" /> 

其中有一项USAGE就表示着minio的语法：

`minio [FLAGES] COMMAND [ARGS...]`

其中[flages]就表示选项，可以传入的选项有--certs-dir、--quiet、--anonymous、--json、-h、--version。

COMMAND表示命令，只能使用server命令，server也就表示了去启动minio服务。

之后是[ARGS]，也就是该命令可以传入的参数，那minio server命令可以传入哪些参数呢？我们使用minio server --help来查看一下：

<img src=".\images\image-20240617142944562.png" alt="image-20240617142944562" style="zoom: 67%;" /> 

由USAGE用法中，可以看到，minio server可以传入flages，也可以传入dir。这个flages表示的是选项，这个dir表示的是目录。

flages可以传入的选项下面都有，这个dir目录也就是存储minio服务中的数据的。

那么，最简单的启动minio服务的语句是：

```shell
minio server ./
```

也就是启动minio服务，并将当前目录位置作为存储minio服务数据的目录。

<img src=".\images\image-20240617143620559.png" alt="image-20240617143620559" style="zoom: 67%;" /> 

出现出上面的界面，就表示MinIO服务启动成功。

上面有两个地址非常重要：

**1.MinIO的接口地址：**

<img src=".\images\image-20240617143846212.png" alt="image-20240617143846212" style="zoom:67%;" /> 

若我们在项目中，去编写一个上传文件或删除文件的功能时，这个时候就需要访问这个接口地址。

<img src=".\images\image-20240617143947099.png" alt="image-20240617143947099" style="zoom: 67%;" /> 

那为什么会有三个地址呢？

这其实是因为Linux的虚拟机处在三个网络下，我们使用ifconfig来查看一下：

<img src=".\images\image-20240617144120100.png" alt="image-20240617144120100" style="zoom:67%;" /> 

这三个网络分别是Vmware虚拟出来的虚拟子网、本地回环网络、以及虚拟网桥。在不同网络中，IP地址是不同的，MinIO服务在不同的网络中，IP地址也是不一样的，所以会出现三个不同的网络地址。

如果我们想要在主机中去访问MinIO的接口地址，也就是三个网络地址中的第一个的网络地址。



**2.MinIO后台服务管理界面地址：**

<img src=".\images\image-20240617144543101.png" alt="image-20240617144543101" style="zoom:67%;" /> 

同样地，在这里会有三个地址，若我们想在主机中进行访问，访问的是第一个地址。

这里地址的端口号不是固定的，而是随机的，若能在主机中打开这个网络地址，说明minio服务是正常运行的：

<img src=".\images\image-20240617144744405.png" alt="image-20240617144744405" style="zoom: 67%;" /> 





#### 集成Systemd

**Systemd概述**

我们所使用的systemctl命令，都是由systemd命令所提供的。

Systemd是一个广泛应用于Linux系统的系统初始化和服务管理器，其可以管理系统中的各种服务和进程，包括启动、停止和重启服务，除此之外，其还可以检测各服务的运行状态，并在服务异常退出时，自动拉起服务，以保证服务的稳定性。系统的防火墙服务firewalld，我们自己安装的mysqld和redis均是由Systemd进行管理的，那么，我们将MinIO服务也交给Systemd管理。

**编写MinIO服务配置文件**

systemd所管理的服务需要由一个配置文件，这些配置文件均位于/etc/systemd/system/或/usr/lib/systemd/system/目录下，下面创建MinIO服务的配置文件。

执行以下命令创建并打开minio.service文件：

```shell
vim /etc/systemd/system/minio.service
```

内容如下，具体可参考MinIO官方文档：[官方文档](https://min.io/docs/minio/linux/operations/install-deploy-manage/deploy-minio-single-node-single-drive.html#create-the-systemd-service-file)。

```ini
[Unit]
Description=MinIO
Documentation=https://min.io/docs/minio/linux/index.html
Wants=network-online.target
After=network-online.target
AssertFileIsExecutable=/usr/local/bin/minio

[Service]
WorkingDirectory=/usr/local
ProtectProc=invisible
EnvironmentFile=-/etc/default/minio
ExecStartPre=/bin/bash -c "if [ -z \"${MINIO_VOLUMES}\" ]; then echo \"Variable MINIO_VOLUMES not set in /etc/default/minio\"; exit 1; fi"
ExecStart=/usr/local/bin/minio server $MINIO_OPTS $MINIO_VOLUMES
Restart=always
LimitNOFILE=65536
TasksMax=infinity
TimeoutStopSec=infinity
SendSIGKILL=no

[Install]
WantedBy=multi-user.target
```

需要注意的是，在粘贴时一定要将vim模式转换成输入模式，否则在一般模式下，粘贴的内容会不完整，因为普通模式下，会根据粘贴的内容执行相关命令。

**一些重要参数的说明：**

* `EnvirommentFile`：这个参数用于指定minio的环境变量文件，在这个文件中，可以配置MinIO服务所需的各项参数。也就是说，在这个文件中，可用于去配置一些参数，参数的格式是key=value的形式，然后我们在刚才常见的minio.service文件中可以引用这些参数。
* `EnexStart`：这个参数是用于配置MinIO服务的启动命令，也就是minio server，后面跟着的`$MINIO_OPTS`表示选项，`$MINIO_VOLUMES`表示MinIO服务的数据存储路径。这两个$符号的参数，均是引用于EnvironmentFile中的变量。
* `Restart`：表示当MinIO服务意外退出了，Systemd则会自动启动该服务。



**编写EnvironmentFile文件**

该EnvironmentFile文件，是用来配置MinIO的环境变量的。

使用vim命令来创建并且打开文件，注意文件目录必须与上面所配置的minio.service文件中的设置一样：

```shell
vim /etc/default/minio
```

内容如下：

```shell
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_VOLUMES=/data
MINIO_OPTS="--console-address :9001"
```

**参数的含义：**

* `MINIO_ROOT_USER`和`MINIO_ROOT_PASSWORD`表示声明MINIO服务初始的用户名和密码。**注意**：用户名和密码长度至少为8位。
* `MINIO_VOLUMES`用于指定数据的存储路径，那么也就是说，我们将MINIO服务的数据存放在/data目录下。
* `MINIO_OPTS`用于配置启动minio服务的选项，这里我们只配置了--console-address的选项，这个选项表示的是固定minio服务的端口号。在上面说过，minio的api端口号是固定的，但是minio后台管理的端口号不是固定的，所以我们将其设置为固定的9001。



**创建minio存储数据的目录**

在上面，我们配置了MinIO服务的数据是存储在/data目录下的，所以我们这里要去创建data目录：

```shell
mkdir /data
```





#### 启动MinIO

在集成了Systemd服务之后，我们就不再使用minio server这样的语句去启动minio了，而是使用systemd给我们提供的命令systemctl：

```shell
systemctl start minio
```

执行以下命令查询运行状态：

```shell
systemctl status minio
```

设置MinIO开机自启：

```shell
systemctl enable minio
```



#### 访问MinIO管理页面

我们在之前的/etc/default/minio配置文件中，设置了MioIO的后台服务端口号为9001，所以我们在主机中访问虚拟机的MinIO后台服务页面的地址为：http://虚拟机地址:9001：

<img src=".\images\image-20240617153331957.png" alt="image-20240617153331957" style="zoom:67%;" /> 





---

## 2、技术储备

要求会MyBatis-plus、MinIO、Redis与Knife，具体内容请分别查看各自的笔记。



---

# 七、项目开发（:star:）















---

# 八、项目优化















---

# 九、部署准备

