## 1、MySQL8的主要目录结构

我们在Linux系统中，使用下面的命令：

```shell
find / -name mysql
```

去查找所有带有mysql的文件目录，执行结果：

![image-20240327090121998](.\images\image-20240327090121998.png)

### 1.1、数据库文件的存放路径

> **MySQL数据库文件的存放路径：`/var/lib/mysql/`**

MySQL服务器程序在启动时会到文件系统的某个目录下加载一些文件，之后在运行过程中产生的数据也都会存储到这个目录下的某些文件中，这个目录就称为`数据目录`。这里的数据目录也就是/var/lib/mysql/。

MySQL把数据都存到哪个路径下呢？其实`数据目录`对应着一个系统变量`datadir`，我们在使用客户端与服务器建立连接之后查看这个系统变量的值就可以了：

![image-20240327090631116](.\images\image-20240327090631116.png)

从结果中可以看出，在Linux系统上MySQL的数据目录就是`/var/lib/mysql/`。

如果是在Windows系统上，同样可以使用这个命令去查看数据目录的位置：

![image-20240327090815630](.\images\image-20240327090815630.png)



### 1.2、相关命令目录

> **相关命令目录：`/usr/bin`（mysqladmin、mysqlbinlog、mysqldump等命令）和`/usr/sbin。`**

![image-20240327091210259](.\images\image-20240327091210259.png)

安装目录下非常重要的`bin`目录，它里面存储了许多关于控制客户端程序和服务器程序的命令（许多可执行文件，比如mysql，mysqld，mysqld_safe等）。而`数据目录`是用来存储MySQL在运行过程中产生的数据，注意区分开二者。



### 1.3、配置文件目录

> **配置文件目录：`/usr/share/mysql-8.0`（命令及配置文件）和`/etc`（如my.cnf）**

![image-20240327092052047](.\images\image-20240327092052047.png)





## 2、数据库和文件系统的关系

像`InnoDB`、`MyISAM`这样的存储引擎就是把表存储在磁盘上的，操作系统用来管理磁盘的结构被称为`文件系统`，所以用专业一点的话来表述就是：**像`InnoDB`、`MyISAM`这样的存储引擎就是`把表存储在文件系统上的`。**当我们想读取数据的时候，这些存储引擎会从文件系统中把数据读出来返回给我们，当我们想写入数据的时候，这些存储引擎会把这些数据又写回文件系统。本章学习一下`InnoDB`和`MyISAM`这两个存储引擎的数据如何在文件系统中存储。

### 2.1、查看默认数据库

查看一下我们有哪些数据库：

```sql
show databases;
```

可以看到有4个数据库是属于MySQL自带的数据库：`mysql`、`information_schema`、`performance_schema`、`sys`。

* **`mysql`**

  MySQL系统自带的核心数据库，它存储了MySQL的用户账户和权限信息，一些存储过程、事件的定义信息，一些运行过程中产生的日志信息，一些帮助信息以及时区信息等。

* **`information_schema`**

  MySQL系统自带的数据库，这个数据库保存着MySQL服务器`维护的所有其他数据库的信息`，比如有哪些表、哪些视图、哪些触发器、哪些列、哪些索引。

* **`performance_schema`**

  MySQL系统自带的数据库，这个数据库里主要保存MySQL服务器运行过程中的一些状态信息，可以用来`监控MySQL服务的各类性能指标`。

* **`sys`**

  MySQL系统自带的数据库，这个数据库主要是通过`视图`的形式把`information_schema`和`performance_schema`结合起来，帮助系统管理员和开发人员监控MySQL的技术性能。



## 2.2、数据库在文件系统中的表示

### Innodb存储引擎模式

首先，我们分别查看一下在MySQL的数据目录中的内容：

![image-20240327112838843](.\images\image-20240327112838843.png)

这个数据目录下的文件和子目录比较多，除了`information_schema`这个系统数据库外，其他数据库在数据目录下都有对应的子目录。使用蓝色字体表示的是数据库文件目录，比如上面的atguigudb数据库文件目录。

以atguigudb数据库为例，在MySQL5.7中打开，先进入到mysql数据库文件存放目录：

```shell
cd /var/lib/mysql/
```

然后就可以查看到所有的数据库文件：

![image-20240402153620748](.\images\image-20240402153620748.png)

然后进入到指定的数据库中，查看数据库文件下存放的数据表文件：

![image-20240327113124718](.\images\image-20240327113124718.png)

在MySQL8.0中打开：

![image-20240327113153719](.\images\image-20240327113153719.png)

由于从MySQL5.5.8开始，MySQL默认使用的是Innodb存储引擎进行存储数据，所以，上面两个版本中，MySQL的存储方式都是使用的是Innodb的存储引擎模式。

**`1. 表结构`**

为了保存表结构，Innodb在数据目录下对应的数据库子目录下创建了一个专门用于`描述表结构的文件`，文件名是这样：

```
表名.frm
```

比如说我们在atguigudb数据库下创建了一个test的表，那在数据库atguigudb对应的子目录下就会创建一个名为`test.frm`的用于描述表结构的文件。.frm文件的格式在不同的平台上都是相同的。这个后缀名为.frm是以`二进制格式`存储的。

**`2.表中数据和索引`**

**① 系统表空间（system tablespace）**

默认情况下，InnoDB会在数据目录下创建一个名为`ibdata1`、大小为`12M`的文件，这个文件就是对应的`系统表空间`在文件系统上的表示。这个文件是`自扩展文件`，当不够用时会自己增加文件大小。

在MySQL5.6之前，InnoDB会默认把各个表的数据存储到系统表空间中。

**② 独立表空间（file-pre-table tablespace）**

在MySQL5.6.6以及之后的版本中，InnoDB并不会默认的把各个表的数据存储到系统表空间中，而是为`每一个表建立一个独立表空间`，也就是我们创建了多少个表，就有多少个独立表空间。使用`独立表空间`来存储表数据的话，会在该表所属数据库对应的子目录下创建一个表示该独立表空间的文件，文件名和表名相同，只不过添加一个`.idb`的扩展名而已，所以完整的文件名称长这样：

```
表名.idb
```

比如：我们使用了`独立表空间`去存储atguigudb数据库下的test表的话，那么在该表所在数据库对应的atguigudb目录下会为test表创建这两个文件：

```
test.frm
test.idb
```

其中test.idb文件就用来存储test表中的**数据和索引**。

**③ 系统表空间与独立表空间的设置**

我们可以自己指定使用`系统表空间`还是`独立表空间`来存储数据，这个功能由启动参数`innodb_file_per_table`控制，比如说我们想刻意将表数据都存储到`系统表空间`时，可以在启动MySQL服务器的时候这样配置：

```
[server]
innodb_file_per_table=0  #0：代表使用系统表空间;1：代表使用独立表空间
```

默认情况：

![image-20240327121835269](.\images\image-20240327121835269.png)

**④ 其他类型的表空间**

随着MySQL的发展，除了上述两种老牌表空间之外，现在还新提出一些不同类型的表空间，比如通用表空间（general tablespace）、临时表空间（temporary tablespace）等。



**`疑问`：.frm文件在MySQL8中不存在了，那.frm文件到哪里去了呢？**

在MySQL8.0及以后，将表的结构以及表中的数据、索引合为同一个文件，都存放到独立表空间`.idb`这个文件中去了，这样一来就方便进行管理。



**`结论：`**

> **在MySQL5.7及之前：**
>
> `.frm`文件用来存储**表的结构**
>
> 在MySQL5.5.6之前，**表数据和索引**存放在系统表空间`ibdata1`目录下。
>
> 在MySQL5.5.6及之后，Innodb会为每一个表建立一个独立表空间`.idb`文件，用于存放**表数据和索引**。
>
> 还会创建`db.opt`文件用于保存数据库的相关配置。比如：字符集、比较规则。
>
> 
>
> **从MySQL8开始：**
>
> 表结构以及数据、索引一起存放在`.idb`文件中，并且不再提供db.opt文件。



### MyISAM存储引擎模式

由于默认使用的都是Innodb存储引擎，所以我们需要在创建表的时候，显式地指定存储引擎MyISAM。

案例：分别在MySQL5.7和MySQL8.0的atguigudb数据库下，创建一个表student_myisam

```sql
CREATE TABLE `student_myisam` (
 `id` bigint NOT NULL AUTO_INCREMENT,
 `name` varchar(64) DEFAULT NULL,
 `age` int DEFAULT NULL,
 `sex` varchar(2) DEFAULT NULL,
 PRIMARY KEY (`id`)
 )ENGINE=MYISAM AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb3;
```

然后来分别查看一下，在MySQL5.7和MySQL8.0中，atguigudb数据库对应的文件系统下的所有文件信息：

**MySQL5.7版本中**

![image-20240327122625160](.\images\image-20240327122625160.png)

在MySQL的5.7版本MyISAM存储引擎中：

> * `.frm`文件存储的是表的结构
>
> * `.MYD`存储的是表的数据
> * `.MYI`存储的是表的索引



**MySQL8.0版本中**

![image-20240327122651691](.\images\image-20240327122651691.png)

在MySQL8.0版本MyISAM存储引擎中：

> * `.sdi`文件存储的是表的结构
> * `.MYD`存储的是表的数据
> * `.MYI`存储的是表的索引





### 存储模式总结

举例：数据库a，表b

1、如果表b采用**`InnoDB引擎`**：

* `b.frm`：描述表结构文件，字段长度等
* 如果采用的是**系统表空间**模式，数据和索引都存储在`ibdata1`中
* 如果采用的是**独立表空间**模式，数据和索引都存储在`b.idb`文件中。

**此外需要注意：**

1）MySQL5.7会在数据库对应的文件目录下生成`db.opt`文件用于保存数据库的相关配置。比如：字符集、比较规则。而MySQL8.0不再提供db.opt文件。

2）MySQL8.0不再提供b.frm文件，而是将表结构文件一起合并在b.idb文件中。



例如：在MySQL8.0的atguigudb数据库下，创建了employees表，就会在atguigudb数据库对应的数据目录下，创建如下的文件：

![image-20240327124816876](.\images\image-20240327124816876.png)

而在MySQL8.0中，就会创建下面的文件：

![image-20240327124736040](.\images\image-20240327124736040.png)





---

2、如果表b采用**`MyISAM引擎`**，数据库目录中会产生三个文件：

* 表结构文件：
  * MySQL5.7中：`b.frm`
  * MySQL8.0中：`b.xxx.sdi`

* 数据信息文件（存储数据信息，这里的前提是采用独立表存储模式）：
  * `b.MYD`(MYData)
* 索引信息文件：
  * `b.MYI`(MYIndex)



例如：

MySQL5.7的atguigudb数据库中创建了student_myisam表，则在该数据库对应的数据目录下，就会创建如下三个文件：

![image-20240327124510979](.\images\image-20240327124510979.png)

而在MySQL8.0中，创建的文件如下所示：

![image-20240327124846119](.\images\image-20240327124846119.png)